# linux c 线程池简介

#### 原理图

![](README.assets/2020-04-08%2015-34-46%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

#### 概述

在服务器开发过程中，使用并行/并发编程是经常会遇到的事情。

基于进程的服务器和基于线程的服务器的区别就不详述了，这里简介一下多线程的优缺点：

优点：

- 多个线程同时执行，提高了程序的执行效率
- 提高了资源利用率

缺点：

- 线程越多，cpu调度的开销越大
- 程序的复杂度上升

使用线程池的优点：

- 创建/销毁线程伴随着系统开销，过于频繁的创建/销毁线程，会很大程度上影响处理效率
- 线程并发数量过多，抢占系统资源从而导致阻塞，且操作系统对创建的线程最大数量会有一定限制
- 对线程进行一些简单的管理，如延时执行、定时循环执行等

#### 实现原理

------

程序启动之前，创建一定数量的线程，放入空闲的队列中，初始化线程池。

这些线程均处于阻塞状态，只占一点内存，不占用cpu。

当任务到达就从线程池中取出一个空闲线程，将任务传入此线程中运行。

当所有的线程都处在处理任务的时候，线程池将自动创建一定数量的新线程，用于处理更多的任务。

执行完任务的线程也并不退出，而是继续在线程池中等待下一次任务。

但大部分线程处于阻塞状态时，线程池将自动销毁一部分线程，回收系统资源。

#### 组成部分

------

- 线程管理器
  - 用于创建并管理线程池。
- 工作线程
  - 线程池中实际执行任务的线程。在初始化线程时会预先创建好固定数目的线程在池中，这些初始化的线程一般处于空闲状态，一般不占用CPU，占用较小的内存空间。
- 任务接口
  - 每个任务必须实现的接口，当线程池的任务队列中有可执行任务时，被空闲的工作线程调去执行，把任务抽象出来形成接口，可以做到线程池与具体的任务无关。
- 任务队列
  - 用来存放没有处理的任务，提供一种缓冲机制
  - 实现这种结构有好几种方法，常用的是队列，主要运用先进先出原理，另外一种是链表之类的数据结构，可以动态的为它分配内存空间，应用中比较灵活